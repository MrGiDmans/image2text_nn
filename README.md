# üñºÔ∏è Image-to-Text Neural Network

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥–ø–∏—Å–µ–π –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Encoder-Decoder –Ω–∞ –æ—Å–Ω–æ–≤–µ ResNet-50 (—ç–Ω–∫–æ–¥–µ—Ä) –∏ LSTM (–¥–µ–∫–æ–¥–µ—Ä).

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
2. [–î–∞—Ç–∞—Å–µ—Ç](#–¥–∞—Ç–∞—Å–µ—Ç)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
4. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–º–æ–¥–µ–ª–∏)
5. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
6. [–ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞](#–∑–∞–ø—É—Å–∫-–ø—Ä–æ–µ–∫—Ç–∞)
7. [–ú–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ü–µ–Ω–∫–∞](#–º–µ—Ç—Ä–∏–∫–∏-–∏-–æ—Ü–µ–Ω–∫–∞)
8. [–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã](#–ª–æ–≥–∏–∫–∞-—Ä–∞–±–æ—Ç—ã)
9. [–¢–æ–Ω–∫–æ—Å—Ç–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏](#—Ç–æ–Ω–∫–æ—Å—Ç–∏-–∏-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.8+
- CUDA 12.6+ (–¥–ª—è GPU, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- 8GB+ RAM
- 4GB+ VRAM (–¥–ª—è GPU)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ —Å–∫–∞—á–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç**

2. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**

```bash
python -m venv .venv
```

3. **–ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ:**

**Windows:**
```bash
.venv\Scripts\activate
```

**Linux/Mac:**
```bash
source .venv/bin/activate
```

4. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**

```bash
pip install -r requirements.txt
```

**–î–ª—è Windows (–µ—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã —Å PyTorch):**
```bash
pip install -r requirements_windows.txt
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —Ä–∞—Å—á–µ—Ç–∞ BLEU-–º–µ—Ç—Ä–∏–∫–∏:
```bash
pip install nltk
# –∏–ª–∏
pip install sacrebleu
```

---

## üì¶ –î–∞—Ç–∞—Å–µ—Ç

### Flickr8k

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞—Ç–∞—Å–µ—Ç **Flickr8k**, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç:
- ~8000 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- ~5 –ø–æ–¥–ø–∏—Å–µ–π –∫ –∫–∞–∂–¥–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: 500√ó500 –ø–∏–∫—Å–µ–ª–µ–π

### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–∞—Ç–∞—Å–µ—Ç–∞

1. –°–∫–∞—á–∞–π—Ç–µ –¥–∞—Ç–∞—Å–µ—Ç —Å [Kaggle](https://www.kaggle.com/datasets/aladdinpersson/flickr8kimagescaptions)
2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –∞—Ä—Ö–∏–≤ –≤ –ø–∞–ø–∫—É `data/flickr8k/`
3. **–í–∞–∂–Ω–æ:** –ü—Ä–µ–æ–±—Ä–∞–∑—É–π—Ç–µ —Ñ–∞–π–ª –ø–æ–¥–ø–∏—Å–µ–π –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞ `.txt` –≤ `.csv`

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞

```
data/
‚îî‚îÄ‚îÄ flickr8k/
    ‚îú‚îÄ‚îÄ images/
    ‚îÇ   ‚îú‚îÄ‚îÄ 667626_18933d713e.jpg
    ‚îÇ   ‚îú‚îÄ‚îÄ 3637013_c675de7705.jpg
    ‚îÇ   ‚îî‚îÄ‚îÄ ...
    ‚îî‚îÄ‚îÄ captions.csv
```

### –§–æ—Ä–º–∞—Ç `captions.csv`

```csv
image,caption
667626_18933d713e.jpg,"A child in a pink dress is climbing up a set of stairs in an entry way ."
667626_18933d713e.jpg,"A girl going into a wooden building ."
...
```

**–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞** = –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ + –æ–¥–Ω–∞ –ø–æ–¥–ø–∏—Å—å. –î–ª—è –æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫ —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–¥–ø–∏—Å—è–º–∏.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
image2text_nn/
‚îú‚îÄ‚îÄ config.yaml              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ requirements.txt          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ vocab.pkl                # –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ checkpoints/             # –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ best_checkpoint.pth.tar
‚îÇ   ‚îî‚îÄ‚îÄ last_checkpoint.pth.tar
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ flickr8k/
‚îÇ       ‚îú‚îÄ‚îÄ images/
‚îÇ       ‚îî‚îÄ‚îÄ captions.csv
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ train.py             # –°–∫—Ä–∏–ø—Ç –æ–±—É—á–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ test.py              # –°–∫—Ä–∏–ø—Ç –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
    ‚îú‚îÄ‚îÄ models/
    ‚îÇ   ‚îú‚îÄ‚îÄ encoder_cnn.py   # CNN-—ç–Ω–∫–æ–¥–µ—Ä (ResNet-50)
    ‚îÇ   ‚îú‚îÄ‚îÄ decoder_rnn.py   # LSTM-–¥–µ–∫–æ–¥–µ—Ä
    ‚îÇ   ‚îî‚îÄ‚îÄ caption_model.py # –û–±–µ—Ä—Ç–∫–∞ Encoder+Decoder
    ‚îî‚îÄ‚îÄ utils/
        ‚îú‚îÄ‚îÄ dataSet.py       # –ö–ª–∞—Å—Å Dataset –¥–ª—è Flickr8k
        ‚îú‚îÄ‚îÄ dataLoader.py    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DataLoader
        ‚îú‚îÄ‚îÄ vocabulary.py   # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è
        ‚îú‚îÄ‚îÄ collate_fn.py    # –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±–∞—Ç—á–µ–π
        ‚îî‚îÄ‚îÄ transforms.py   # –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```

---

## üß† –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–∏

### –û–±—â–∞—è —Å—Ö–µ–º–∞

```
–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí EncoderCNN ‚Üí –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏—á–∏ ‚Üí DecoderRNN ‚Üí –ü–æ–¥–ø–∏—Å—å
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### 1. **EncoderCNN** (`src/models/encoder_cnn.py`)

- **–û—Å–Ω–æ–≤–∞:** ResNet-50 (–ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è –Ω–∞ ImageNet)
- **–§—É–Ω–∫—Ü–∏—è:** –ò–∑–≤–ª–µ–∫–∞–µ—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- **–í—ã—Ö–æ–¥:**
  - `features`: `[B, num_pixels, encoder_dim]` ‚Äî –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ attention)
  - `global_feat`: `[B, encoder_dim]` ‚Äî –≥–ª–æ–±–∞–ª—å–Ω—ã–π –≤–µ–∫—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `encoded_image_size`: –†–∞–∑–º–µ—Ä feature map (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 14√ó14)
- `embed_dim`: –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤—ã—Ö–æ–¥–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (512)
- `fine_tune`: –†–∞–∑–º–æ—Ä–∞–∂–∏–≤–∞—Ç—å –ª–∏ –≤–µ—Å–∞ ResNet (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `False`)

#### 2. **DecoderRNN** (`src/models/decoder_rnn.py`)

- **–¢–∏–ø:** LSTM (–æ–¥–Ω–æ—Å–ª–æ–π–Ω—ã–π)
- **–§—É–Ω–∫—Ü–∏—è:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–ª–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- **–í—Ö–æ–¥:**
  - –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏—á–∏ —ç–Ω–∫–æ–¥–µ—Ä–∞
  - –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å–ª–æ–≤ (teacher forcing –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏)
- **–í—ã—Ö–æ–¥:** –õ–æ–≥–∏—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ–≤–∞ –≤ —Å–ª–æ–≤–∞—Ä–µ

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- `Embedding`: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ —Å–ª–æ–≤ –≤ –≤–µ–∫—Ç–æ—Ä—ã
- `LSTM`: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `Linear`: –ü—Ä–æ–µ–∫—Ü–∏—è –≤ —Ä–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è

#### 3. **CaptioningModel** (`src/models/caption_model.py`)

- **–§—É–Ω–∫—Ü–∏—è:** –û–±—ä–µ–¥–∏–Ω—è–µ—Ç Encoder –∏ Decoder
- **–ú–µ—Ç–æ–¥—ã:**
  - `forward()`: –û–±—É—á–µ–Ω–∏–µ (teacher forcing)
  - `generate()`: –ò–Ω—Ñ–µ—Ä–µ–Ω—Å (greedy –∏–ª–∏ beam search)

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –æ–±—É—á–µ–Ω–∏–∏

1. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí `[B, 3, 224, 224]`
2. **EncoderCNN** ‚Üí `global_feat: [B, 512]`
3. **–ü–æ–¥–ø–∏—Å—å** ‚Üí —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è ‚Üí `[B, T_max]` (—Å BOS/EOS –∏ padding)
4. **DecoderRNN**:
   - –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å–ª–æ–≤ + –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏—á–∏ ‚Üí LSTM ‚Üí –ª–æ–≥–∏—Ç—ã
   - –í—ã—Ö–æ–¥: `[B, T_max, vocab_size]`
5. **Loss:** CrossEntropyLoss (–∏–≥–Ω–æ—Ä–∏—Ä—É—è PAD —Ç–æ–∫–µ–Ω—ã)

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–µ

1. **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ** ‚Üí EncoderCNN ‚Üí `global_feat`
2. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:** `h0, c0` –∏–∑ `global_feat`
3. **–ê–≤—Ç–æ—Ä–µ–≥—Ä–µ—Å—Å–∏—è:**
   - –ù–∞—á–∞–ª–æ: `<BOS>`
   - –ù–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ: –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–ª–æ–≤–æ ‚Üí LSTM ‚Üí —Å–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ
   - –û—Å—Ç–∞–Ω–æ–≤–∫–∞: `<EOS>` –∏–ª–∏ `max_len`
4. **–†–µ–∂–∏–º—ã:**
   - **Greedy:** –í—ã–±–∏—Ä–∞–µ–º —Å–ª–æ–≤–æ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é
   - **Beam search:** –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º `beam_size` –ª—É—á—à–∏—Ö –≥–∏–ø–æ—Ç–µ–∑

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `config.yaml`. –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∫–∞–∂–¥–æ–º—É –ø–∞—Ä–∞–º–µ—Ç—Ä—É –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `src/README.md`.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ–∫—Ü–∏–∏

#### **device**
```yaml
device: "cuda"  # –∏–ª–∏ "cpu"
```

#### **data**
```yaml
data:
  images_dir: "./data/flickr8k/images"
  caption_file: "./data/flickr8k/captions.csv"
  vocab_path: "./vocab.pkl"
  image_size: 224
  batch_size: 32
  num_workers: 4
  val_split: 0.2
  freq_threshold: 5
```

#### **model**
```yaml
model:
  embed_size: 512        # –†–∞–∑–º–µ—Ä —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ —Å–ª–æ–≤
  decoder_dim: 512       # –†–∞–∑–º–µ—Ä —Å–∫—Ä—ã—Ç–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è LSTM
  encoder_dim: 512       # –†–∞–∑–º–µ—Ä –≤—ã—Ö–æ–¥–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ —ç–Ω–∫–æ–¥–µ—Ä–∞
  dropout: 0.5
  encoder_fine_tune: false
  encoded_image_size: 14
```

#### **training**
```yaml
training:
  epochs: 50
  lr: 1e-4              # Learning rate –¥–ª—è –¥–µ–∫–æ–¥–µ—Ä–∞
  lr_mode: "continue"   # "continue" –∏–ª–∏ "finetune"
  finetune_lr: 1e-5     # Learning rate –¥–ª—è —ç–Ω–∫–æ–¥–µ—Ä–∞ (–µ—Å–ª–∏ finetune)
  grad_clip: 5.0
  use_amp: true         # –°–º–µ—à–∞–Ω–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å (FP16)
  save_every_epoch: false
  checkpoint_dir: "./checkpoints"
  resume_from: null
```

**–í–∞–∂–Ω–æ:** –ü—Ä–∏ `lr_mode: "continue"` –æ–±–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (encoder/decoder) –∏—Å–ø–æ–ª—å–∑—É—é—Ç `lr: 1e-4`. –ü—Ä–∏ `lr_mode: "finetune"` encoder –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `finetune_lr: 1e-5`, decoder ‚Äî `lr: 1e-4`.

#### **early_stopping**
```yaml
early_stopping:
  enabled: true
  patience: 5
  min_delta: 1e-4
  track_overfitting: true
  overfitting_gap_threshold: 0.5
  overfitting_patience: 3
```

**–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è:**
- `track_overfitting`: –í–∫–ª—é—á–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ gap –º–µ–∂–¥—É train/val loss
- `overfitting_gap_threshold`: –ü–æ—Ä–æ–≥ —Ä–∞–∑–Ω–∏—Ü—ã (train_loss - val_loss < -0.5 = –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ)
- `overfitting_patience`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö —Å –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ–º –¥–æ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### 1. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏

```bash
python src/train.py --config config.yaml
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--config`: –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É —Ñ–∞–π–ª—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `config.yaml`)
- `--resume`: –ü—É—Ç—å –∫ —á–µ–∫–ø–æ–∏–Ω—Ç—É –¥–ª—è –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä:**
```bash
python src/train.py --config config.yaml --resume ./checkpoints/last_checkpoint.pth.tar
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ó–∞–≥—Ä—É–∑–∫–∞/—Å–æ–∑–¥–∞–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è –∏–∑ –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å–µ–π
2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ train/val (80/20)
3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ (EncoderCNN + DecoderRNN)
4. –¶–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è:
   - Forward pass —Å teacher forcing
   - Backward pass —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–º –∫–ª–∏–ø–ø–∏–Ω–≥–æ–º
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Å —Ä–∞—Å—á–µ—Ç–æ–º BLEU
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ–∫–ø–æ–∏–Ω—Ç–æ–≤
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è

**–í—ã–≤–æ–¥ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:**
```
Epoch 1: train loss=4.5802, val loss=3.9686, gap=0.6116, BLEU: 5.89
Epoch 2: train loss=3.8404, val loss=3.6225, gap=0.2179, BLEU: 6.21
...
Epoch 23: train loss=2.3655, val loss=2.5876, gap=-0.2221 ‚ö†Ô∏è, BLEU: 11.63 [–ü–ï–†–ï–û–ë–£–ß–ï–ù–ò–ï]
```

**–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
- `gap > 0`: –ù–æ—Ä–º–∞ (train loss –≤—ã—à–µ val loss ‚Äî –º–æ–¥–µ–ª—å –µ—â–µ —É—á–∏—Ç—Å—è)
- `gap < 0` —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º: –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ (val loss –≤—ã—à–µ train loss)
- `[–ü–ï–†–ï–û–ë–£–ß–ï–ù–ò–ï]`: –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ, —Å—á–µ—Ç—á–∏–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∏–Ω—Ñ–µ—Ä–µ–Ω—Å)

```bash
python src/test.py --image path/to/image.jpg --checkpoint ./checkpoints/best_checkpoint.pth.tar
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--image`: –ü—É—Ç—å –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `--checkpoint`: –ü—É—Ç—å –∫ —á–µ–∫–ø–æ–∏–Ω—Ç—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `./checkpoints/best_checkpoint.pth.tar`)
- `--vocab`: –ü—É—Ç—å –∫ —Å–ª–æ–≤–∞—Ä—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `./vocab.pkl`)
- `--max_len`: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –ø–æ–¥–ø–∏—Å–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 20)
- `--beam_size`: –†–∞–∑–º–µ—Ä beam –¥–ª—è beam search (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 3)
- `--mode`: –†–µ–∂–∏–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ‚Äî `"greedy"` –∏–ª–∏ `"beam"` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `"greedy"`)
- `--device`: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ ‚Äî `"cuda"` –∏–ª–∏ `"cpu"`

**–ü—Ä–∏–º–µ—Ä—ã:**

Greedy –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
python src/test.py --image data/flickr8k/images/667626_18933d713e.jpg
```

Beam search:
```bash
python src/test.py --image data/flickr8k/images/667626_18933d713e.jpg --mode beam --beam_size 5
```

**–í—ã–≤–æ–¥:**
```
–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ –∏–∑ ./checkpoints/best_checkpoint.pth.tar...
–ú–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –†–∞–∑–º–µ—Ä —Å–ª–æ–≤–∞—Ä—è: 3566

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ –¥–ª—è data/flickr8k/images/667626_18933d713e.jpg...

üì∑ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: data/flickr8k/images/667626_18933d713e.jpg
üìù –ü–æ–¥–ø–∏—Å—å: a child in a pink dress is climbing up a set of stairs
üîß –†–µ–∂–∏–º: greedy
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ü–µ–Ω–∫–∞

### 1. **Loss (CrossEntropyLoss)**

- **–§—É–Ω–∫—Ü–∏—è:** –ò–∑–º–µ—Ä—è–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –∏ –∏—Å—Ç–∏–Ω–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å:** –ò–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç PAD —Ç–æ–∫–µ–Ω—ã (`ignore_index=vocab.pad_idx`)
- **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:** –ß–µ–º –º–µ–Ω—å—à–µ, —Ç–µ–º –ª—É—á—à–µ. –û–±—ã—á–Ω–æ —Å–Ω–∏–∂–∞–µ—Ç—Å—è —Å 4-5 –¥–æ 2-3.

### 2. **BLEU Score**

- **–¢–∏–ø:** –ú–µ—Ç—Ä–∏–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ–≤–æ–¥–∞/–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞
- **–î–∏–∞–ø–∞–∑–æ–Ω:** 0-100 (—á–µ–º –≤—ã—à–µ, —Ç–µ–º –ª—É—á—à–µ)
- **–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `sacrebleu` (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω) –∏–ª–∏ `nltk`
  - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏ —Å —ç—Ç–∞–ª–æ–Ω–Ω—ã–º–∏
- **–¢–∏–ø–∏—á–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:**
  - –ù–∞—á–∞–ª–æ –æ–±—É—á–µ–Ω–∏—è: 5-10
  - –•–æ—Ä–æ—à–∞—è –º–æ–¥–µ–ª—å: 15-25
  - –û—Ç–ª–∏—á–Ω–∞—è –º–æ–¥–µ–ª—å: 25+

### 3. **Train/Val Gap**

- **–§–æ—Ä–º—É–ª–∞:** `gap = train_loss - val_loss`
- **–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è:**
  - `gap > 0`: –ù–æ—Ä–º–∞ (–º–æ–¥–µ–ª—å –µ—â–µ —É—á–∏—Ç—Å—è)
  - `gap ‚âà 0`: –ò–¥–µ–∞–ª—å–Ω–æ (–º–æ–¥–µ–ª—å —Ö–æ—Ä–æ—à–æ –æ–±–æ–±—â–∞–µ—Ç—Å—è)
  - `gap < -0.5`: –ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ (val loss –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –≤—ã—à–µ train loss)

### 4. **Early Stopping**

–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ –ø—Ä–∏:
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —É–ª—É—á—à–µ–Ω–∏–π:** `val_loss` –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ `patience` —ç–ø–æ—Ö
- **–ü–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–∏:** Gap –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥ –≤ —Ç–µ—á–µ–Ω–∏–µ `overfitting_patience` —ç–ø–æ—Ö

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π:**
   - –ß—Ç–µ–Ω–∏–µ `captions.csv`
   - –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–µ–π

2. **–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Å–ª–æ–≤–∞—Ä—è (`Vocabulary`):**
   - –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π
   - –ü–æ–¥—Å—á–µ—Ç —á–∞—Å—Ç–æ—Ç —Å–ª–æ–≤
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª–æ–≤ —Å —á–∞—Å—Ç–æ—Ç–æ–π ‚â• `freq_threshold`
   - –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã: `<PAD>`, `<BOS>`, `<EOS>`, `<UNK>`
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ `vocab.pkl`

3. **–°–æ–∑–¥–∞–Ω–∏–µ Dataset:**
   - –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
   - –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–π (resize, crop, normalize)
   - –¢–æ–∫–µ–Ω–∏–∑–∞—Ü–∏—è –∏ —á–∏—Å–ª–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π

4. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ train/val:**
   - 80% train, 20% val (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `val_split`)

### –≠—Ç–∞–ø 2: –û–±—É—á–µ–Ω–∏–µ

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏:**
   - EncoderCNN (ResNet-50, –∑–∞–º–æ—Ä–æ–∂–µ–Ω –∏–ª–∏ —Ä–∞–∑–º–æ—Ä–æ–∂–µ–Ω)
   - DecoderRNN (LSTM —Å dropout)
   - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ `CaptioningModel`

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞:**
   - Adam —Å —Ä–∞–∑–Ω—ã–º–∏ LR –¥–ª—è encoder/decoder (–µ—Å–ª–∏ `finetune`)
   - –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π –∫–ª–∏–ø–ø–∏–Ω–≥ (`grad_clip`)

3. **–¶–∏–∫–ª –æ–±—É—á–µ–Ω–∏—è (—ç–ø–æ—Ö–∞):**
   - **Train:**
     - Teacher forcing: –ø–æ–¥–∞–µ–º –∏—Å—Ç–∏–Ω–Ω—É—é –ø–æ–¥–ø–∏—Å—å –≤ –¥–µ–∫–æ–¥–µ—Ä
     - Forward: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí encoder ‚Üí decoder ‚Üí –ª–æ–≥–∏—Ç—ã
     - Loss: —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–æ–≥–∏—Ç–æ–≤ —Å –∏—Å—Ç–∏–Ω–Ω—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
     - Backward: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Å–æ–≤
   - **Validation:**
     - –ë–µ–∑ teacher forcing (–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ loss)
     - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ BLEU
     - –î–µ—Ç–µ–∫—Ü–∏—è –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è

4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:**
   - `best_checkpoint.pth.tar`: –õ—É—á—à–∞—è –º–æ–¥–µ–ª—å (–º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π val_loss)
   - `last_checkpoint.pth.tar`: –ü–æ—Å–ª–µ–¥–Ω—è—è —ç–ø–æ—Ö–∞
   - `epoch_XXX.pth.tar`: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π —ç–ø–æ—Ö–∏ (–µ—Å–ª–∏ `save_every_epoch: true`)

### –≠—Ç–∞–ø 3: –ò–Ω—Ñ–µ—Ä–µ–Ω—Å

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏:**
   - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏–∑ —á–µ–∫–ø–æ–∏–Ω—Ç–∞
   - –ó–∞–≥—Ä—É–∑–∫–∞ –≤–µ—Å–æ–≤

2. **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
   - Resize ‚Üí CenterCrop ‚Üí Normalize
   - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ —Ç–µ–Ω–∑–æ—Ä `[1, 3, 224, 224]`

3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è:**
   - Encoder: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Üí –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏—á–∏
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è LSTM –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Ñ–∏—á
   - –ê–≤—Ç–æ—Ä–µ–≥—Ä–µ—Å—Å–∏—è:
     - –ù–∞—á–∞–ª–æ: `<BOS>`
     - –®–∞–≥: –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–ª–æ–≤–æ ‚Üí LSTM ‚Üí —Å–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ
     - –û—Å—Ç–∞–Ω–æ–≤–∫–∞: `<EOS>` –∏–ª–∏ `max_len`
   - –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ: –∏–Ω–¥–µ–∫—Å—ã ‚Üí —Å–ª–æ–≤–∞

---

## üí° –¢–æ–Ω–∫–æ—Å—Ç–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **AMP (Automatic Mixed Precision):**
   - –í–∫–ª—é—á–∏—Ç–µ `use_amp: true` –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –Ω–∞ GPU
   - –≠–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏ –∏ —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 1.5-2 —Ä–∞–∑–∞

2. **Batch Size:**
   - –£–≤–µ–ª–∏—á—å—Ç–µ `batch_size` –¥–æ 64-128, –µ—Å–ª–∏ –µ—Å—Ç—å VRAM
   - –ë–æ–ª—å—à–∏–π batch ‚Üí —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã

3. **Num Workers:**
   - –ù–∞ Windows –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ 0 (–∏–∑-–∑–∞ spawn)
   - –ù–∞ Linux/Mac –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ 4-8

### –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è

1. **Dropout:**
   - –£–≤–µ–ª–∏—á—å—Ç–µ `dropout: 0.5` ‚Üí `0.6-0.7` –ø—Ä–∏ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–∏

2. **–†–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è Encoder:**
   - –û—Å—Ç–∞–≤—å—Ç–µ `encoder_fine_tune: false` (encoder –∑–∞–º–æ—Ä–æ–∂–µ–Ω)
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `finetune_lr: 1e-6` (–æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π LR)

3. **Early Stopping:**
   - –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `overfitting_gap_threshold: 0.3-0.5`
   - –£–º–µ–Ω—å—à–∏—Ç–µ `overfitting_patience: 2-3` –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

### –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞

1. **Beam Search:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `beam_size: 5-7` –¥–ª—è –ª—É—á—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–µ–µ

2. **–£–≤–µ–ª–∏—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏:**
   - `decoder_dim: 512` ‚Üí `768` –∏–ª–∏ `1024`
   - `embed_size: 512` ‚Üí `768`
   - –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏

3. **Fine-tuning Encoder:**
   - –í–∫–ª—é—á–∏—Ç–µ `encoder_fine_tune: true` —Å `finetune_lr: 1e-5`
   - –ú–æ–∂–µ—Ç —É–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ, –Ω–æ —Ä–∏—Å–∫ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è

### –û—Ç–ª–∞–¥–∫–∞

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `captions.csv` –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

2. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è:**
   - –°–ª–µ–¥–∏—Ç–µ –∑–∞ gap –º–µ–∂–¥—É train/val loss
   - –ï—Å–ª–∏ gap —Ä–∞—Å—Ç–µ—Ç ‚Üí –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ
   - –ï—Å–ª–∏ val loss –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ –º–æ–¥–µ–ª—å—é

3. **–ü—Ä–æ–±–ª–µ–º—ã —Å –ø–∞–º—è—Ç—å—é:**
   - –£–º–µ–Ω—å—à–∏—Ç–µ `batch_size`
   - –û—Ç–∫–ª—é—á–∏—Ç–µ `use_amp: false` (–Ω–æ –±—É–¥–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
   - –£–º–µ–Ω—å—à–∏—Ç–µ `image_size: 224` ‚Üí `196`

### –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å

- `seed: 42` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `random_state` –≤ `DataLoaderConfig`

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:** `src/README.md`
- **–î–∞—Ç–∞—Å–µ—Ç:** [Flickr8k –Ω–∞ Kaggle](https://www.kaggle.com/datasets/aladdinpersson/flickr8kimagescaptions)
- **PyTorch:** [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://pytorch.org/docs/stable/index.html)

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Windows + multiprocessing:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `num_workers=0`
   - –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, –Ω–æ –æ–±—É—á–µ–Ω–∏–µ –±—É–¥–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ

2. **CUDA out of memory:**
   - –£–º–µ–Ω—å—à–∏—Ç–µ `batch_size`
   - –û—Ç–∫–ª—é—á–∏—Ç–µ `use_amp` (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ FP32)

3. **BLEU –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `nltk` –∏–ª–∏ `sacrebleu`
   - –ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ `metrics.bleu: false`

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö.

---

## üë§ –ê–≤—Ç–æ—Ä

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –∫—É—Ä—Å–∞ –ø–æ –Ω–µ–π—Ä–æ–Ω–Ω—ã–º —Å–µ—Ç—è–º.
